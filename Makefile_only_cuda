SRC_DIR=src
HEADER_DIR=include
OBJ_DIR=obj

CC=gcc
NVCC=nvcc  # Use nvcc for CUDA compilation

CFLAGS=-O0 -fsanitize=address -ggdb -Wall -Wextra -I$(HEADER_DIR) 
CUDA_CFLAGS=-O0  -I$(HEADER_DIR) -I/usr/local/cuda/include
LDFLAGS=-lm -L/usr/local/cuda/lib64

SRC= dgif_lib.c \
    egif_lib.c \
    gif_err.c \
    gif_font.c \
    gif_hash.c \
    gifalloc.c \
    cuda_functions.cu \
    main.c \
    openbsd-reallocarray.c \
    quantize.c 

OBJ= $(OBJ_DIR)/dgif_lib.o \
    $(OBJ_DIR)/egif_lib.o \
    $(OBJ_DIR)/gif_err.o \
    $(OBJ_DIR)/gif_font.o \
    $(OBJ_DIR)/gif_hash.o \
    $(OBJ_DIR)/gifalloc.o \
    $(OBJ_DIR)/cuda_functions.o \
    $(OBJ_DIR)/main.o \
    $(OBJ_DIR)/openbsd-reallocarray.o \
    $(OBJ_DIR)/quantize.o \

all: $(OBJ_DIR) sobelf

$(OBJ_DIR):
	mkdir $(OBJ_DIR)

$(OBJ_DIR)/cuda_functions.o: $(SRC_DIR)/cuda_functions.cu
	$(NVCC) $(CUDA_CFLAGS) -c -o $@ $<

$(OBJ_DIR)/%.o : $(SRC_DIR)/%.c $(HEADER_DIR)/cuda_functions.h
	$(NVCC) $(CUDA_CFLAGS) -c -o $@ $< -lcudart


sobelf: $(OBJ)
	$(NVCC) $(CUDA_CFLAGS) -o $@ $^ $(LDFLAGS) -lcudart

clean:
	rm -f sobelf $(OBJ)
